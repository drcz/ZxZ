#include "wasm4.h"
uint8_t visible_from(uint8_t,uint8_t,uint8_t,uint8_t); /// :)

//// display config whatever //////////////////////////////////////////////////////
#define CENTRE 76 // (SCREEN_SIZE - SPRITE_SIZE)/2 = (190-8)/2 m'kay?

#define VIEW_RADIUS_W 11 // enough to fit the screen + offset for animation
#define VIEW_RADIUS_H 11

#define MIN_TIME 10 /// clock steps count before button works on title,gameover etc

//// main state and stuff, just in case ///////////////////////////////////////////
uint8_t game_behind_mirror = 0;
uint16_t oxygen_level = 16*99; /// whatever.
uint8_t clock = 0;

enum {TITLE,BRIEFING,GAME,OVER,VICTOLY};
uint8_t gamestate;
uint8_t subframe = 0;

void victoly();
void gameover();


//// JOYSTICK AND STUFF ///////////////////////////////////////////////////////////

enum {DIR_U,DIR_L,DIR_D,DIR_R,DIR_C};

uint8_t joystick = DIR_C;

void reset_joystick() { joystick = DIR_C; } /// \o/

/// todo: może jeśli wciśnione są jednocześnie up i down [right i left] to zeruj oba?
void update_joystick() {
    uint8_t gamepad = *GAMEPAD1;
    if (gamepad & BUTTON_UP) joystick = DIR_U;
    if (gamepad & BUTTON_LEFT) joystick = DIR_L;
    if (gamepad & BUTTON_DOWN) joystick = DIR_D;
    if (gamepad & BUTTON_RIGHT) joystick = DIR_R;
}

//// simple sfx... ////////////////////////////////////////////////////////////////
void sfx_push() { tone(200, 10|(3<<8)|(6<<24), 40, TONE_NOISE); }
void sfx_open() { tone(200|(400<<16), 4|(4<<8)|(6<<24), 36, TONE_NOISE); }
void sfx_boom() { tone(120|(80<<16), 60, 100, TONE_NOISE); }
void sfx_step() { tone(30, 2|(2<<8)|(2<<24), 57, TONE_TRIANGLE); }
void sfx_death() {
    tone(320|(30<<16), 80|(5<<8)|(1<<24), 60, TONE_PULSE1|TONE_MODE2);
    tone(666, 10|(90<<24)|(10<<8), 100, TONE_NOISE); 
}

void sfx_win() { sfx_death(); } // TODO coś wymyśl

uint8_t music_on = 1; /// :)

//// SPRITES AND STUFF ////////////////////////////////////////////////////////////

enum { RS_FLOOR,
       RS_ACTOR_LR, RS_ACTOR_LR2, RS_ACTOR_LR3,
       RS_ACTOR_D, RS_ACTOR_D23, RS_ACTOR_U, RS_ACTOR_U23,
       RS_WALL,RS_WALL_O,RS_DIRT,RS_DIRT2,
       RS_WALL_H1,RS_WALL_H2,RS_WALL_H3,
       RS_PIPE_H,RS_PIPE_H2,RS_PIPE_HE,RS_PIPE_HS,RS_PIPE_T,
       RS_BARELL,
       RS_LEVER_L,RS_LEVER_R,
       RS_BOMB,RS_EXPLOSION12,RS_DETONATOR_0,RS_DETONATOR_1,
       RS_PARTICLE_UDLR,RS_GUN_UDLR,
       RS_EVIL_EYE_C,RS_EVIL_EYE_C2,RS_EVIL_EYE_RL,RS_EVIL_EYE_RL2,
       RS_MIRROR,
       RS_ROBOT_UDLR,RS_JOYSTICK,
       RS_DOOR,RS_DOOR_O,
       RS_OXYGEN,
       RS_CRYSTAL,
       RS_ELECTRIC,
       RS_FIRE, RS_SMOKE,
       RS_TENTACLES1,RS_TENTACLES2,
       RS_CORKSCREW,
       RS_BIGBATON,
       RAW_SPRITES_COUNT };

const uint8_t raw_sprites[RAW_SPRITES_COUNT][16] = {
    { /// RS_FLOOR
      0b00000000,0b00000000,
      0b00010000,0b00000000,
      0b00000000,0b00000100,
      0b00000000,0b00000000,
      0b00000000,0b00000000,
      0b00000000,0b00000000,
      0b00000100,0b00000000,
      0b00000000,0b00000000
    },
    { /// RS_ACTOR_LR
      0b00000001,0b01010000,
      0b00001001,0b01110000,
      0b00001001,0b01110000,
      0b00001001,0b10010000,
      0b00000001,0b10010000,
      0b00000001,0b10010000,
      0b00000001,0b01000000,
      0b00000001,0b01000000
    },
    { /// RS_ACTOR_LR2
      0b00000001,0b01010000,
      0b00001001,0b01110000,
      0b00001001,0b01110000,
      0b00001001,0b10010000,
      0b00000001,0b10010000,
      0b00000001,0b01100000,
      0b00000101,0b01010000,
      0b00000000,0b00010000
    },
    { /// RS_ACTOR_LR3
      0b00000001,0b01010000,
      0b00001001,0b01110000,
      0b00001001,0b01110000,
      0b00001001,0b10010000,
      0b00000001,0b10010000,
      0b00000001,0b10010000,
      0b00000001,0b01010000,
      0b00000001,0b00000000
    },
    { /// RS_ACTOR_D
      0b00000101,0b01010000,
      0b00000111,0b11010000,
      0b00010111,0b11010100,
      0b00010101,0b01010100,
      0b00100110,0b10011000,
      0b00100101,0b01011000,
      0b00000100,0b00010000,
      0b00000100,0b00010000
    },
    { /// RS_ACTOR_D23
      0b00000101,0b01010000,
      0b00000111,0b11010000,
      0b00010111,0b11010100,
      0b00100101,0b01010100,
      0b00100110,0b10011000,
      0b00000101,0b01011000,
      0b00000100,0b00010000,
      0b00000100,0b00000000
    },
    { /// RS_ACTOR_U
      0b00000101,0b01010000,
      0b00000110,0b10010000,
      0b00010110,0b10010100,
      0b00010110,0b10010100,
      0b00010101,0b01010100,
      0b00010101,0b01010100,
      0b00000100,0b00010000,
      0b00000100,0b00010000
    },
    { /// RS_ACTOR_U23
      0b00000101,0b01010000,
      0b00000110,0b10010000,
      0b00010110,0b10010100,
      0b00010110,0b10010100,
      0b00010101,0b01010100,
      0b00000101,0b01010100,
      0b00000100,0b00010000,
      0b00000100,0b00000000
    },
    { /// RS_WALL
      0b10101010,0b10101001,
      0b10101010,0b10100101,
      0b10100101,0b01100101,
      0b10100111,0b11100101,
      0b10100111,0b11100101,
      0b10101010,0b10100101,
      0b10010101,0b01010101,
      0b01010101,0b01010101
    },
    { /// RS_WALL_O
      0b11111111,0b11111110,
      0b11101010,0b10101001,
      0b11101010,0b10101001,
      0b11101011,0b11101001,
      0b11101001,0b01101001,
      0b11101010,0b10101001,
      0b11101010,0b10101001,
      0b10010101,0b01010101
    },
    { /// RS_DIRT
      0b00000000,0b00000101,
      0b00000100,0b00000101,
      0b00000100,0b00000000,
      0b00000000,0b00000100,
      0b00000001,0b01010100,
      0b00010000,0b01100100,
      0b00000000,0b01000000,
      0b00000000,0b00000000
    },
    { /// RS_DIRT2
      0b00000000,0b00000000,
      0b00000001,0b01000000,
      0b00000110,0b01000000,
      0b00010101,0b01000001,
      0b00010101,0b00000000,
      0b00000000,0b00000101,
      0b00000000,0b00000101,
      0b00000000,0b00000000
    },
    { /// RS_WALL_H1
      0b00000000,0b00000000,
      0b11111111,0b11111111,
      0b11111111,0b11111111,
      0b10101010,0b10101010,
      0b10101010,0b10101010,
      0b01010101,0b01010101,
      0b01010101,0b01010101,
      0b00000000,0b00000000
    },
    { /// RS_WALL_H2
      0b00000000,0b00000000,
      0b11111111,0b11111111,
      0b11111111,0b11111111,
      0b10101011,0b11101010,
      0b10101001,0b01101010,
      0b01010101,0b01010101,
      0b01010101,0b01010101,
      0b00000000,0b00000000
    },
    { /// RS_WALL_H3
      0b00000000,0b00000000,
      0b11111111,0b11111111,
      0b11111010,0b10101111,
      0b10101001,0b01101010,
      0b10101011,0b11101010,
      0b01011010,0b10100101,
      0b01010101,0b01010101,
      0b00000000,0b00000000
    },
    { /// RS_PIPE_H
      0b00000000,0b00000000,
      0b00000000,0b00000000,
      0b10101010,0b10101010,
      0b11111111,0b11111111,
      0b01010101,0b01010101,
      0b10101010,0b10101010,
      0b00000000,0b00000000,
      0b00000000,0b00000000
    },
    { /// RS_PIPE_H2
      0b00000000,0b00000000,
      0b00000010,0b10100000,
      0b10101010,0b11101010,
      0b11111111,0b11111111,
      0b01010101,0b01010101,
      0b10101010,0b01101010,
      0b00000010,0b10100000,
      0b00000000,0b00000000
    },
    { /// RS_PIPE_HE
      0b00000000,0b00000000,
      0b00000000,0b00000010,
      0b10101010,0b10101011,
      0b11111111,0b11111111,
      0b01010101,0b01010101,
      0b10101010,0b10101001,
      0b00000000,0b00000010,
      0b00000000,0b00000000
    },
    { /// RS_PIPE_HS
      0b00000000,0b00000000,
      0b10100000,0b00000000,
      0b11110110,0b10101010,
      0b11110111,0b11111111,
      0b10100101,0b01010101,
      0b01010110,0b10101010,
      0b10100000,0b00000000,
      0b00000000,0b00000000
    },
    { /// RS_PIPE_T
      0b00000000,0b00000000,
      0b00000000,0b00000010,
      0b00000000,0b10101011,
      0b00000010,0b11111111,
      0b00001011,0b11101010,
      0b00001011,0b10100101,
      0b00001011,0b10010010,
      0b00101111,0b10011000
    },
    { /// RS_BARELL
      0b00000000,0b00000000,
      0b01010101,0b01010101,
      0b00011011,0b10100100,
      0b00011011,0b10100100,
      0b01010110,0b01010101,
      0b00011011,0b10100100,
      0b00011011,0b10100100,
      0b01010101,0b01010101
    },
    { /// RS_LEVER_L
      0b00000000,0b00000000,
      0b11100000,0b00000000,
      0b10010000,0b00000000,
      0b00100100,0b00000000,
      0b00001001,0b00000000,
      0b00000010,0b01000000,
      0b00010101,0b01010100,
      0b01101110,0b10100101
    },
    { /// RS_LEVER_R
      0b00000000,0b00000000,
      0b00000000,0b00001110,
      0b00000000,0b00001001,
      0b00000000,0b00100100,
      0b00000000,0b10010000,
      0b00000010,0b01000000,
      0b00010101,0b01010100,
      0b01101110,0b10100101
    },
    { /// RS_BOMB
      0b00010000,0b01000100,
      0b00011010,0b01101000,
      0b10010101,0b01011001,
      0b10010111,0b11011001,
      0b01010111,0b11010101,
      0b10010101,0b01011001,
      0b10010110,0b01011001,
      0b00011010,0b01101000
    },
    { /// RS_EXPLOSION12
      0b00100010,0b10001010,
      0b00001011,0b10101100,
      0b10101111,0b11111010,
      0b00111111,0b11111110,
      0b10101111,0b11111110,
      0b10111111,0b11111011,
      0b00101011,0b10111100,
      0b00001000,0b10000010
    },
    { /// RS_DETONATOR_0
      0b01010101,0b01010101,
      0b00000010,0b01000000,
      0b00000010,0b01000000,
      0b00000010,0b01000000,
      0b00000101,0b01010000,
      0b00011110,0b10010100,
      0b00011110,0b10010100,
      0b00011110,0b10010100
    },
    { /// RS_DETONATOR_1
      0b00000000,0b00000000,
      0b00000000,0b00000000,
      0b01010101,0b01010101,
      0b00000010,0b01000000,
      0b00000101,0b01010000,
      0b00011110,0b10010100,
      0b00011110,0b10010100,
      0b00011110,0b10010100
    },
    { /// RS_PARTICLE_UDLR
      0b00000000,0b00000000,
      0b00000000,0b00000000,
      0b00000000,0b00000000,
      0b00000100,0b10001111,
      0b00010000,0b10001111,
      0b00000000,0b00000000,
      0b00000000,0b00000000,
      0b00000000,0b00000000
    },
    { /// RS_GUN_UDLR
      0b01000000,0b00000000,
      0b01110000,0b00000000,
      0b01111001,0b00100000,
      0b01101001,0b11000000,
      0b01101001,0b11000000,
      0b01011001,0b00100000,
      0b01010000,0b00000000,
      0b01000000,0b00000000
    },
    { /// RS_EVIL_EYE_C
      0b10101010,0b10101010,
      0b01010101,0b01010101,
      0b01011010,0b10100101,
      0b01111100,0b00111101,
      0b01111100,0b00111101,
      0b01011111,0b11110101,
      0b01010101,0b01010101,
      0b10101010,0b10101010
    },
    { /// RS_EVIL_EYE_C2
      0b10101010,0b10101010,
      0b01010101,0b01010101,
      0b01011010,0b10100101,
      0b01101010,0b10101001,
      0b01111100,0b00111101,
      0b01011111,0b11110101,
      0b01010101,0b01010101,
      0b10101010,0b10101010
    },
    { /// RS_EVIL_EYE_RL
      0b10101010,0b10101010,
      0b01010101,0b01010101,
      0b01011010,0b10100101,
      0b01111111,0b00001101,
      0b01111111,0b00001101,
      0b01011111,0b11110101,
      0b01010101,0b01010101,
      0b10101010,0b10101010
    },
    { /// RS_EVIL_EYE_RL2
      0b10101010,0b10101010,
      0b01010101,0b01010101,
      0b01011010,0b10100101,
      0b01101010,0b10101001,
      0b01111111,0b00001101,
      0b01011111,0b11110101,
      0b01010101,0b01010101,
      0b10101010,0b10101010
    },
    { /// RS_MIRROR
      0b00000101,0b01010000,
      0b00001010,0b11100000,
      0b00011011,0b10100100,
      0b10011110,0b10100110,
      0b10001010,0b10110010,
      0b10001010,0b11100010,
      0b10000001,0b01000010,
      0b10010000,0b00000110
    },
    { /// RS_ROBOT_UDLR
      0b10100100,0b10100100,
      0b00010000,0b00010010,
      0b01101010,0b10100001,
      0b01101111,0b01100101,
      0b01100101,0b01100101,
      0b01101010,0b10100001,
      0b00010000,0b00010010,
      0b10100100,0b10100100
    },
    { /// RS_JOYSTICK
      0b00001110,0b10010000,
      0b00001110,0b10010000,
      0b00000001,0b01000000,
      0b00000010,0b01000000,
      0b00000010,0b01000000,
      0b00000010,0b01000000,
      0b00111010,0b10100100,
      0b11111010,0b10100101
    },
    { /// RS_DOOR
      0b00101010,0b10101000,
      0b10010101,0b00100101,
      0b10010101,0b00100101,
      0b10010100,0b10010101,
      0b10010010,0b01010101,
      0b10010010,0b01010101,
      0b10010010,0b01010101,
      0b00010101,0b01010100
    },
    { /// RS_DOOR_O
      0b00101010,0b10101000,
      0b10010110,0b00000000,
      0b10010110,0b00000000,
      0b10011000,0b00000010,
      0b10100000,0b00001001,
      0b10100000,0b00001001,
      0b10100000,0b00001001,
      0b00010101,0b01010100
    },
    { /// RS_OXYGEN
      0b00000010,0b01010000,
      0b00000000,0b01000000,
      0b00000011,0b10010000,
      0b00001110,0b10010100,
      0b00001110,0b10010100,
      0b00001110,0b10010100,
      0b00001110,0b10010100,
      0b00001110,0b10010100
    },
    { /// RS_CRYSTAL
      0b00000000,0b00000000,
      0b00000011,0b10000000,
      0b00001111,0b10100000,
      0b00111111,0b10101000,
      0b00101010,0b01010100,
      0b00001010,0b01010000,
      0b00000010,0b01000000,
      0b00000000,0b00000000
    },
    { /// RS_ELECTRIC
      0b00000000,0b00000000,
      0b00100000,0b00001000,
      0b00111100,0b10000011,
      0b11000011,0b00111100,
      0b00000000,0b11000000,
      0b00101100,0b00001000,
      0b11110011,0b00001011,
      0b00001000,0b00000000
    },
    { /// RS_FIRE
      0b00001000,0b00000000,
      0b00101110,0b00110010,
      0b10111111,0b10111011,
      0b10111011,0b11111111,
      0b11111110,0b11101111,
      0b11111010,0b10101110,
      0b11101010,0b10101011,
      0b11101010,0b10101011
    },
    { /// RS_SMOKE
      0b00000101,0b00000100,
      0b00010101,0b01010101,
      0b00010101,0b01010101,
      0b00000101,0b01010101,
      0b00010101,0b01010100,
      0b00000101,0b01010000,
      0b00000000,0b00000000,
      0b00000000,0b00000000
    },
    { /// RS_TENTACLES1
      0b00000000,0b00110000,
      0b11101000,0b00100000,
      0b00001010,0b01100100,
      0b00001010,0b00101001,
      0b00001000,0b00101001,
      0b00101000,0b01101010,
      0b10101001,0b01011010,
      0b10100101,0b01011010
    },
    { /// RS_TENTACLES2
      0b00000011,0b01000011,
      0b00100000,0b00011010,
      0b10011000,0b00001001,
      0b11001000,0b00100101,
      0b00001000,0b01101000,
      0b00101001,0b01101000,
      0b10101001,0b01001010,
      0b10100101,0b01011010
    },
    { /// RS_CORKSCREW
      0b00001111,0b11110000,
      0b00111010,0b10100100,
      0b11100000,0b11101001,
      0b11100011,0b10011001,
      0b11101110,0b01001001,
      0b11101001,0b00001001,
      0b00111010,0b10100100,
      0b00000101,0b01010000
    },
    { /// RS_BIGBATON
      0b00000000,0b00000000,
      0b00001111,0b11110000,
      0b00111010,0b10101100,
      0b11101011,0b11101011,
      0b11101001,0b01101011,
      0b01011010,0b10100101,
      0b00010101,0b01010100,
      0b00000101,0b01010000
    }    
};

enum { S_FLOOR,
       S_DIRT, S_DIRT2,
       S_WALL,S_WALL2,S_WALL_H1,S_WALL_V1,
       S_WALL_H2,S_WALL_V2,S_WALL_H3, S_WALL_V3,
       S_DOOR,S_DOOR_O,
       S_PIPE_H1,S_PIPE_V1,S_PIPE_H2,S_PIPE_V2,
       S_PIPE_HE,S_PIPE_VE,S_PIPE_HS,S_PIPE_VS,
       S_PIPE_BR,S_PIPE_UR,S_PIPE_UL,S_PIPE_BL,
       S_EVIL_EYE_C,S_EVIL_EYE_C2,
       S_EVIL_EYE_L,S_EVIL_EYE_L2,
       S_EVIL_EYE_R,S_EVIL_EYE_R2,
       S_BARELL,
       S_OXYGEN,
       S_CRYSTAL,
       S_PARTICLE_U,S_PARTICLE_U2,
       S_PARTICLE_D,S_PARTICLE_D2,
       S_PARTICLE_L,S_PARTICLE_L2,
       S_PARTICLE_R,S_PARTICLE_R2,
       
       S_EXPLOSION,S_EXPLOSION2,
       S_GUN_U,S_GUN_D,S_GUN_L,S_GUN_R,
       S_BOMB, S_DETONATOR_0,S_DETONATOR_1,
       S_LEVER_L,S_LEVER_R, S_CORKSCREW,
       S_ROBOT_U,S_ROBOT_D,S_ROBOT_L,S_ROBOT_R,S_JOYSTICK,
       S_ELECTRIC_H1,S_ELECTRIC_H2,
       S_ELECTRIC_V1, S_ELECTRIC_V2,
       S_FIRE1, S_FIRE2,
       S_SMOKE1,S_SMOKE2,S_SMOKE3,S_SMOKE4,
       S_MIRROR,
       S_TENTACLES_U,S_TENTACLES_U2,
       S_TENTACLES_D,S_TENTACLES_D2,
       S_TENTACLES_L,S_TENTACLES_L2,
       S_TENTACLES_R,S_TENTACLES_R2,
       
       S_BIGBATON,
       
       S_ACTOR_U,S_ACTOR_U2,S_ACTOR_U3,
       S_ACTOR_D,S_ACTOR_D2,S_ACTOR_D3,
       S_ACTOR_L,S_ACTOR_L2,S_ACTOR_L3,
       S_ACTOR_R,S_ACTOR_R2,S_ACTOR_R3,
       
       SPRITES_COUNT };

typedef struct {
    uint8_t raw_sprite_index;
    uint32_t flags;
} sprite_t;

const sprite_t sprites[SPRITES_COUNT] = {
    {RS_FLOOR,BLIT_2BPP},	/// S_FLOOR
    {RS_DIRT,BLIT_2BPP},	/// S_DIRT
    {RS_DIRT2,BLIT_2BPP}, 	/// S_DIRT2
    {RS_WALL,BLIT_2BPP},	/// S_WALL
    {RS_WALL_O,BLIT_2BPP}, 	/// S_WALL2
    {RS_WALL_H1,BLIT_2BPP}, 	/// S_WALL_H1
    {RS_WALL_H1,BLIT_2BPP|BLIT_ROTATE}, 	/// S_WALL_V1
    {RS_WALL_H2,BLIT_2BPP}, 	/// S_WALL_H2
    {RS_WALL_H2,BLIT_2BPP|BLIT_ROTATE}, 	/// S_WALL_V2
    {RS_WALL_H3,BLIT_2BPP}, 	/// S_WALL_H3
    {RS_WALL_H3,BLIT_2BPP|BLIT_ROTATE}, 	/// S_WALL_V3
    {RS_DOOR,BLIT_2BPP}, 	/// S_DOOR
    {RS_DOOR_O,BLIT_2BPP}, 	/// S_DOOR_O
    {RS_PIPE_H,BLIT_2BPP}, 	/// S_PIPE_H1
    {RS_PIPE_H,BLIT_2BPP|BLIT_ROTATE}, 	/// S_PIPE_V1
    {RS_PIPE_H2,BLIT_2BPP}, 	/// S_PIPE_H2
    {RS_PIPE_H2,BLIT_2BPP|BLIT_ROTATE}, 	/// S_PIPE_V2
    {RS_PIPE_HE,BLIT_2BPP}, 	/// S_PIPE_HE
    {RS_PIPE_HE,BLIT_2BPP|BLIT_ROTATE}, 	/// S_PIPE_VE
    {RS_PIPE_HS,BLIT_2BPP}, 	/// S_PIPE_HS
    {RS_PIPE_HS,BLIT_2BPP|BLIT_ROTATE}, 	/// S_PIPE_VS
    {RS_PIPE_T,BLIT_2BPP}, 	/// S_PIPE_BR
    {RS_PIPE_T,BLIT_2BPP|BLIT_ROTATE}, 	/// S_PIPE_UR
    {RS_PIPE_T,BLIT_2BPP|BLIT_FLIP_X|BLIT_FLIP_Y}, 	/// S_PIPE_UL
    {RS_PIPE_T,BLIT_2BPP|BLIT_FLIP_X}, 	/// S_PIPE_BL

    {RS_EVIL_EYE_C,BLIT_2BPP}, 	/// S_EVIL_EYE_C
    {RS_EVIL_EYE_C2,BLIT_2BPP}, 	/// S_EVIL_EYE_C2
    {RS_EVIL_EYE_RL,BLIT_2BPP|BLIT_FLIP_X}, 	/// S_EVIL_EYE_L
    {RS_EVIL_EYE_RL2,BLIT_2BPP|BLIT_FLIP_X}, 	/// S_EVIL_EYE_L2
    {RS_EVIL_EYE_RL,BLIT_2BPP}, 	/// S_EVIL_EYE_R
    {RS_EVIL_EYE_RL2,BLIT_2BPP}, 	/// S_EVIL_EYE_R2

    {RS_BARELL,BLIT_2BPP},	/// S_BARELL
    {RS_OXYGEN,BLIT_2BPP},	/// S_OXYGEN
    {RS_CRYSTAL,BLIT_2BPP},	/// S_CRYSTAL

    {RS_PARTICLE_UDLR,BLIT_2BPP|BLIT_ROTATE},	/// S_PARTICLE_U
    {RS_PARTICLE_UDLR,BLIT_2BPP|BLIT_ROTATE|BLIT_FLIP_Y},	/// S_PARTICLE_U2
    {RS_PARTICLE_UDLR,BLIT_2BPP|BLIT_ROTATE|BLIT_FLIP_X},	/// S_PARTICLE_D
    {RS_PARTICLE_UDLR,BLIT_2BPP|BLIT_ROTATE|BLIT_FLIP_Y|BLIT_FLIP_X},	/// S_PARTICLE_D2
    {RS_PARTICLE_UDLR,BLIT_2BPP|BLIT_FLIP_X},	/// S_PARTICLE_L
    {RS_PARTICLE_UDLR,BLIT_2BPP|BLIT_FLIP_X|BLIT_FLIP_Y},	/// S_PARTICLE_L2
    {RS_PARTICLE_UDLR,BLIT_2BPP},	/// S_PARTICLE_R
    {RS_PARTICLE_UDLR,BLIT_2BPP|BLIT_FLIP_Y},	/// S_PARTICLE_R2

    {RS_EXPLOSION12,BLIT_2BPP},	/// S_EXPLOSION
    {RS_EXPLOSION12,BLIT_2BPP|BLIT_ROTATE},	/// S_EXPLOSION2

    {RS_GUN_UDLR,BLIT_2BPP|BLIT_ROTATE},	/// S_GUN_U
    {RS_GUN_UDLR,BLIT_2BPP|BLIT_ROTATE|BLIT_FLIP_X},	/// S_GUN_D
    {RS_GUN_UDLR,BLIT_2BPP|BLIT_FLIP_X},	/// S_GUN_L
    {RS_GUN_UDLR,BLIT_2BPP},	/// S_GUN_R

    {RS_BOMB,BLIT_2BPP},	/// S_BOMB

    {RS_DETONATOR_0,BLIT_2BPP},	/// S_DETONATOR_0
    {RS_DETONATOR_1,BLIT_2BPP},	/// S_DETONATOR_1
    {RS_LEVER_L,BLIT_2BPP},	/// S_LEVER_L
    {RS_LEVER_R,BLIT_2BPP},	/// S_LEVER_R
    {RS_CORKSCREW,BLIT_2BPP},	/// S_CORKSCREW

    {RS_ROBOT_UDLR,BLIT_2BPP|BLIT_ROTATE},	/// S_ROBOT_U
    {RS_ROBOT_UDLR,BLIT_2BPP|BLIT_ROTATE|BLIT_FLIP_X},	/// S_ROBOT_D
    {RS_ROBOT_UDLR,BLIT_2BPP|BLIT_FLIP_X},	/// S_ROBOT_L
    {RS_ROBOT_UDLR,BLIT_2BPP},	/// S_ROBOT_R

    {RS_JOYSTICK,BLIT_2BPP}, /// S_JOYSTICK

    {RS_ELECTRIC,BLIT_2BPP}, /// S_ELECTRIC_H1
    {RS_ELECTRIC,BLIT_2BPP|BLIT_FLIP_Y}, /// S_ELECTRIC_H2
    {RS_ELECTRIC,BLIT_2BPP|BLIT_ROTATE}, /// S_ELECTRIC_V1
    {RS_ELECTRIC,BLIT_2BPP|BLIT_ROTATE|BLIT_FLIP_Y}, /// S_ELECTRIC_V2

    {RS_FIRE,BLIT_2BPP}, /// S_FIRE1
    {RS_FIRE,BLIT_2BPP|BLIT_FLIP_X}, /// S_FIRE2

    {RS_SMOKE,BLIT_2BPP}, /// S_SMOKE1
    {RS_SMOKE,BLIT_2BPP|BLIT_FLIP_X}, /// S_SMOKE2
    {RS_SMOKE,BLIT_2BPP|BLIT_ROTATE}, /// S_SMOKE3
    {RS_SMOKE,BLIT_2BPP|BLIT_ROTATE|BLIT_FLIP_X}, /// S_SMOKE4

    {RS_MIRROR,BLIT_2BPP},	/// S_MIRROR

    //// TODOOOOOO
    {RS_TENTACLES1,BLIT_2BPP},	/// S_TENTACLES_U
    {RS_TENTACLES2,BLIT_2BPP},	/// S_TENTACLES_U2
    {RS_TENTACLES1,BLIT_2BPP|BLIT_FLIP_Y},	/// S_TENTACLES_D
    {RS_TENTACLES2,BLIT_2BPP|BLIT_FLIP_Y},	/// S_TENTACLES_D2
    {RS_TENTACLES1,BLIT_2BPP|BLIT_ROTATE},	/// S_TENTACLES_L
    {RS_TENTACLES2,BLIT_2BPP|BLIT_ROTATE},	/// S_TENTACLES_L2
    {RS_TENTACLES1,BLIT_2BPP|BLIT_ROTATE|BLIT_FLIP_Y},	/// S_TENTACLES_R
    {RS_TENTACLES2,BLIT_2BPP|BLIT_ROTATE|BLIT_FLIP_Y},	/// S_TENTACLES_R2

    {RS_BIGBATON,BLIT_2BPP}, /// S_BIGBATON

    {RS_ACTOR_U,BLIT_2BPP},	/// S_ACTOR_U
    {RS_ACTOR_U23,BLIT_2BPP},	/// S_ACTOR_U2
    {RS_ACTOR_U23,BLIT_2BPP|BLIT_FLIP_X},	/// S_ACTOR_U3
    {RS_ACTOR_D,BLIT_2BPP},	/// S_ACTOR_D
    {RS_ACTOR_D23,BLIT_2BPP},	/// S_ACTOR_D2
    {RS_ACTOR_D23,BLIT_2BPP|BLIT_FLIP_X},	/// S_ACTOR_D3
    {RS_ACTOR_LR,BLIT_2BPP|BLIT_FLIP_X},	/// S_ACTOR_L
    {RS_ACTOR_LR2,BLIT_2BPP|BLIT_FLIP_X},	/// S_ACTOR_L2
    {RS_ACTOR_LR3,BLIT_2BPP|BLIT_FLIP_X},	/// S_ACTOR_L3
    {RS_ACTOR_LR,BLIT_2BPP},	/// S_ACTOR_R
    {RS_ACTOR_LR2,BLIT_2BPP},	/// S_ACTOR_R2
    {RS_ACTOR_LR3,BLIT_2BPP}	/// S_ACTOR_R3
};


void display_sprite(uint8_t spr, int32_t x, int32_t y) {
    sprite_t s = sprites[spr];
    blit(raw_sprites[s.raw_sprite_index],x,y,8,8,s.flags);
}
// also cf OBJECTS AND STUFF below for binding of things,facings,frames to sprites.


//// MAP AND STUFF ////////////////////////////////////////////////////////////////

#define MAP_W 128 /// these must be powers of 2 for cheap rounding,
#define MAP_H 32  /// cf map_at etc.

const uint8_t the_map[MAP_H][MAP_W] = {
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V2,S_DIRT,S_DIRT,S_DIRT,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_PIPE_HS,S_PIPE_HS,S_PIPE_HS,S_PIPE_HS,S_PIPE_HS,S_PIPE_BL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_L,S_PIPE_HS,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_BL,S_DIRT,S_DIRT,S_DIRT2,S_DIRT2,S_DIRT2,S_DIRT,S_DIRT2,S_DIRT,S_DIRT2,S_DIRT,S_DIRT2,S_DIRT,S_DIRT,S_PIPE_BR,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HS,S_PIPE_HE,S_PIPE_HS,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HS,S_PIPE_H1,S_PIPE_HS,S_CORKSCREW,S_PIPE_H1,S_PIPE_BL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL2,S_WALL_H2,S_WALL_H2,S_WALL,S_DIRT,S_DIRT,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_HS,S_WALL,S_PIPE_HS,S_PIPE_HS,S_PIPE_HS,S_PIPE_HS,S_PIPE_HE,S_PIPE_H1,S_PIPE_BL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_L,S_PIPE_HS,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_BL,S_DIRT2,S_DIRT,S_DIRT,S_DIRT2,S_DIRT,S_DIRT,S_DIRT,S_DIRT2,S_DIRT,S_DIRT,S_DIRT,S_DIRT,S_DIRT2,S_DIRT,S_DIRT,S_PIPE_BR,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HS,S_PIPE_HE,S_PIPE_HS,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HS,S_PIPE_HE,S_PIPE_HS,S_PIPE_HS,S_PIPE_BL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_FLOOR,S_WALL,S_FLOOR,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_BR,S_WALL2,S_WALL_H1,S_WALL2,S_WALL_H1,S_WALL2,S_WALL_H1,S_WALL2,S_WALL_H1,S_WALL2,S_WALL_H1,S_WALL_H1,S_WALL_H2,S_WALL_H1,S_WALL,S_DIRT2,S_DIRT,S_DIRT,S_DIRT,S_DIRT,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_L,S_PIPE_HS,S_WALL,S_WALL,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL2,S_WALL,S_WALL2,S_WALL2,S_WALL2,S_WALL,S_WALL2,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V2,S_DIRT,S_DIRT2,S_DIRT,S_DIRT2,S_DIRT2,S_WALL_V3,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_D,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_U,S_FLOOR,S_GUN_U,S_FLOOR,S_GUN_U,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_FLOOR,S_WALL,S_FLOOR,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V2,S_DIRT2,S_DIRT,S_DIRT,S_DIRT2,S_DIRT,S_WALL_V3,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_U,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_VE,S_FLOOR,S_WALL2,S_FLOOR,S_PIPE_VE,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_U,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_VS,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_WALL,S_WALL,S_DIRT,S_DIRT,S_DIRT,S_WALL,S_GUN_R,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_L,S_WALL,S_WALL_H2,S_WALL_H3,S_WALL_H2,S_WALL_H3,S_WALL,S_GUN_R,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_VS,S_GUN_U,S_PIPE_VS,S_GUN_U,S_PIPE_VS,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_U,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_U,S_PIPE_VS,S_GUN_U,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_U,S_FLOOR,S_GUN_U,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_FLOOR,S_WALL,S_FLOOR,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V2,S_DIRT2,S_DIRT,S_DIRT,S_PIPE_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V1,S_DIRT,S_DIRT2,S_DIRT2,S_DIRT,S_EVIL_EYE_C,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_BR,S_PIPE_HS,S_PIPE_H1,S_PIPE_HE,S_EVIL_EYE_C,S_EVIL_EYE_C,S_EVIL_EYE_C,S_EVIL_EYE_C,S_EVIL_EYE_C,S_EVIL_EYE_C,S_EVIL_EYE_C,S_PIPE_HS,S_PIPE_H1,S_PIPE_HE,S_WALL,S_PIPE_HS,S_PIPE_H1,S_PIPE_H1,S_PIPE_HE,S_EVIL_EYE_C,S_EVIL_EYE_C,S_EVIL_EYE_C,S_EVIL_EYE_C,S_EVIL_EYE_C,S_PIPE_HS,S_PIPE_HE,S_WALL,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL,S_FLOOR,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V2,S_DIRT,S_DIRT2,S_DIRT,S_WALL,S_GUN_R,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_L,S_WALL,S_PIPE_BR,S_PIPE_H1,S_PIPE_H1,S_PIPE_H2,S_WALL,S_GUN_R,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_VE,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_DIRT,S_DIRT2,S_PIPE_VS,S_DIRT,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V1,S_DIRT,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL2,S_DIRT,S_WALL2,S_WALL_H1,S_WALL_H3,S_WALL_H3,S_WALL_H3,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V2,S_DIRT,S_DIRT,S_DIRT,S_PIPE_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V1,S_PIPE_V1,S_PIPE_BR,S_PIPE_H1,S_PIPE_H1,S_PIPE_HE,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_U,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_U,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_BR,S_WALL2,S_GUN_R,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_VS,S_DIRT2,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_FLOOR,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H3,S_WALL_H1,S_WALL_H1,S_WALL_H3,S_WALL_H1,S_WALL_H1,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_BR,S_PIPE_H1,S_PIPE_H1,S_PIPE_H1,S_PIPE_H2,S_PIPE_H1,S_CORKSCREW,S_PIPE_H1,S_PIPE_H2,S_PIPE_H1,S_PIPE_H1,S_PIPE_H2,S_PIPE_H1,S_PIPE_H1,S_WALL,S_PIPE_H1,S_PIPE_H1,S_PIPE_H1,S_WALL,S_GUN_R,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_L,S_WALL,S_PIPE_V1,S_PIPE_V1,S_PIPE_BR,S_PIPE_H1,S_WALL,S_WALL,S_WALL,S_WALL,S_WALL_H1,S_WALL_H2,S_WALL2,S_WALL,S_WALL2,S_WALL_H2,S_WALL,S_WALL_H1,S_WALL2,S_WALL,S_WALL2,S_WALL_H1,S_WALL_H1,S_WALL,S_FLOOR,S_WALL_V2,S_PIPE_VE,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_VS,S_FLOOR,S_PIPE_BR,S_PIPE_HE,S_PIPE_H1,S_PIPE_HE,S_PIPE_HE,S_PIPE_H1,S_PIPE_HE,S_PIPE_HE,S_GUN_R,S_FLOOR,S_PIPE_V1,S_DIRT,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V3,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V1,S_WALL,S_DIRT2,S_DIRT2,S_DIRT,S_DIRT,S_DIRT,S_DIRT2,S_DIRT2,S_DIRT,S_DIRT,S_DIRT2,S_DIRT2,S_DIRT2,S_DIRT,S_DIRT2,S_DIRT,S_DIRT2,S_PIPE_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V1,S_PIPE_V1,S_PIPE_V1,S_PIPE_V1,S_PIPE_BR,S_PIPE_H1,S_PIPE_H1,S_PIPE_H1,S_PIPE_HE,S_PIPE_HE,S_PIPE_BL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_WALL_V1,S_PIPE_UR,S_PIPE_HE,S_PIPE_H1,S_PIPE_HE,S_PIPE_H1,S_PIPE_HE,S_WALL2,S_FLOOR,S_WALL2,S_PIPE_HE,S_PIPE_H1,S_PIPE_HE,S_PIPE_HE,S_GUN_R,S_GUN_D,S_FLOOR,S_PIPE_VE,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V1,S_DIRT,S_FLOOR,S_FLOOR,S_FLOOR,S_EVIL_EYE_C,S_FLOOR,S_EVIL_EYE_C,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V2,S_EVIL_EYE_C,S_DIRT2,S_DIRT,S_DIRT,S_DIRT,S_DIRT2,S_DIRT,S_DIRT,S_DIRT,S_DIRT2,S_DIRT2,S_DIRT,S_DIRT,S_DIRT,S_DIRT,S_DIRT,S_DIRT,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_PIPE_V1,S_PIPE_V1,S_PIPE_V1,S_PIPE_V1,S_PIPE_BR,S_PIPE_BR,S_PIPE_BR,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_BL,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V3,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_WALL_V1,S_DIRT,S_DIRT2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_VE,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_VS,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL2,S_FLOOR,S_WALL2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_PIPE_H1,S_PIPE_H1,S_PIPE_HE,S_DIRT2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V1,S_WALL,S_DIRT,S_DIRT2,S_DIRT,S_DIRT2,S_DIRT,S_DIRT,S_DIRT,S_DIRT2,S_DIRT,S_DIRT,S_DIRT,S_DIRT,S_DIRT2,S_DIRT,S_DIRT2,S_DIRT,S_PIPE_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V1,S_PIPE_V1,S_PIPE_V1,S_PIPE_V1,S_PIPE_V1,S_PIPE_V1,S_PIPE_V1,S_PIPE_V1,S_PIPE_BR,S_PIPE_HE,S_PIPE_HE,S_PIPE_BL,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_WALL_V2,S_DIRT2,S_DIRT,S_DIRT,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_VE,S_DIRT,S_FLOOR,S_PIPE_BR,S_PIPE_HE,S_PIPE_HE,S_PIPE_H1,S_PIPE_HE,S_GUN_R,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_DIRT,S_FLOOR,S_WALL_V2,S_FLOOR,S_WALL_V3,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_PIPE_BR,S_PIPE_H1,S_CORKSCREW,S_PIPE_H2},
{S_WALL_H1,S_WALL_H1,S_WALL_H2,S_WALL_H1,S_WALL_H1,S_WALL,S_FLOOR,S_WALL,S_WALL_H1,S_WALL_H2,S_WALL_H2,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_FLOOR,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL2,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H3,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL,S_EVIL_EYE_C,S_EVIL_EYE_C,S_EVIL_EYE_C,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_PIPE_VS,S_PIPE_VS,S_PIPE_VS,S_PIPE_VS,S_PIPE_VS,S_PIPE_VS,S_PIPE_VS,S_EVIL_EYE_C,S_WALL,S_WALL_H2,S_WALL2,S_FLOOR,S_WALL2,S_WALL_H2,S_WALL,S_WALL_H1,S_WALL2,S_FLOOR,S_WALL2,S_WALL_H1,S_WALL_H1,S_WALL,S_FLOOR,S_WALL,S_WALL_H3,S_WALL_H2,S_WALL_H2,S_WALL_H3,S_WALL_H2,S_WALL_H2,S_WALL_H3,S_WALL_H2,S_WALL_H2,S_WALL_H3,S_WALL_H2,S_WALL_H2,S_WALL_H3,S_WALL_H1,S_WALL,S_FLOOR,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL2,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL2,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL2,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL,S_FLOOR,S_WALL,S_WALL_H1,S_WALL_H2,S_WALL_H2,S_WALL2,S_WALL2,S_WALL2,S_WALL_H2,S_WALL,S_WALL_H2,S_WALL_H2,S_WALL,S_FLOOR,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1},
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_D,S_FLOOR,S_GUN_D,S_FLOOR,S_FLOOR,S_GUN_D,S_GUN_D,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_WALL,S_WALL_H2,S_WALL_H2,S_WALL_H2,S_WALL_H2,S_WALL_H2,S_WALL,S_EVIL_EYE_C,S_WALL,S_WALL_H1,S_WALL_H2,S_WALL_H2,S_WALL_H1,S_WALL,S_DIRT2,S_WALL,S_FLOOR,S_WALL,S_EVIL_EYE_C,S_WALL,S_WALL2,S_WALL2,S_WALL,S_WALL,S_EVIL_EYE_C,S_WALL,S_FLOOR,S_WALL,S_WALL2,S_WALL,S_FLOOR,S_WALL,S_WALL2,S_WALL,S_FLOOR,S_WALL,S_WALL2,S_WALL,S_FLOOR,S_WALL,S_WALL2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_WALL_H3,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_EVIL_EYE_C,S_WALL,S_WALL_H1,S_WALL,S_PIPE_H1,S_WALL,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL2,S_PIPE_H1,S_WALL2,S_WALL_H1,S_WALL_H1,S_WALL,S_PIPE_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL2,S_PIPE_H2,S_PIPE_H2,S_PIPE_H2,S_WALL,S_PIPE_HE,S_EVIL_EYE_C,S_WALL2,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_BR,S_PIPE_HS,S_PIPE_HS,S_WALL,S_PIPE_HS,S_PIPE_HS,S_WALL,S_PIPE_HS,S_PIPE_HS,S_WALL,S_PIPE_HS,S_PIPE_HS,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL,S_EVIL_EYE_C,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1},
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL2,S_DIRT,S_WALL2,S_FLOOR,S_WALL_H3,S_WALL_H1,S_WALL2,S_FLOOR,S_FLOOR,S_PIPE_V1,S_DIRT2,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_WALL_H2,S_WALL_H1,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_VE,S_FLOOR,S_FLOOR,S_WALL_V1,S_DIRT2,S_DIRT,S_DIRT,S_DIRT2,S_DIRT2,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_GUN_L,S_WALL,S_GUN_R,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V1,S_DIRT,S_PIPE_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V2,S_DIRT2,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL2,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V2,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_EVIL_EYE_C,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_U,S_FLOOR,S_FLOOR,S_GUN_U,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_VE,S_FLOOR,S_FLOOR,S_WALL,S_DIRT,S_DIRT2,S_DIRT,S_DIRT2,S_DIRT,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_BR,S_PIPE_BL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_FLOOR,S_PIPE_V2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL2,S_DIRT,S_WALL2,S_FLOOR,S_WALL_H3,S_WALL_H1,S_WALL2,S_FLOOR,S_FLOOR,S_PIPE_V1,S_DIRT2,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V2,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_WALL_H1,S_WALL_H2,S_WALL,S_FLOOR,S_FLOOR,S_GUN_L,S_WALL2,S_PIPE_H1,S_PIPE_H2,S_WALL2,S_GUN_R,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_L,S_WALL,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL,S_FLOOR,S_FLOOR,S_PIPE_BR,S_WALL2,S_PIPE_HE,S_FLOOR,S_PIPE_HS,S_WALL2,S_FLOOR,S_FLOOR,S_WALL_V1,S_DIRT,S_DIRT2,S_DIRT,S_DIRT,S_DIRT2,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V1,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_WALL_H2,S_WALL_H3,S_WALL_H2,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_GUN_L,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_WALL_H1,S_WALL,S_DIRT2,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_WALL2,S_WALL2,S_WALL,S_WALL,S_WALL,S_WALL,S_FLOOR,S_WALL,S_WALL,S_WALL_H2,S_WALL_H3,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H3,S_WALL_H2,S_WALL,S_WALL_H2,S_WALL_H1,S_WALL_H3,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_WALL_H3,S_WALL_H1,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V1,S_DIRT,S_DIRT2,S_PIPE_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_DIRT2,S_WALL_V1,S_DIRT2,S_WALL_V1,S_FLOOR,S_FLOOR,S_GUN_D,S_PIPE_VE,S_DIRT2,S_FLOOR,S_DIRT,S_PIPE_VE,S_FLOOR,S_FLOOR,S_WALL,S_DIRT,S_PIPE_BR,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_UR,S_WALL2,S_PIPE_BL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_DIRT,S_DIRT,S_DIRT2,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_FLOOR,S_PIPE_V2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_L,S_PIPE_HS,S_PIPE_HS,S_PIPE_HS,S_PIPE_HS,S_PIPE_HS,S_WALL2,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_PIPE_VS,S_EVIL_EYE_C,S_PIPE_VS,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_DIRT,S_DIRT,S_PIPE_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL,S_PIPE_HE,S_PIPE_BL,S_GUN_L,S_WALL2,S_PIPE_H2,S_PIPE_H1,S_WALL2,S_GUN_R,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_L,S_WALL,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL,S_FLOOR,S_FLOOR,S_PIPE_BR,S_WALL2,S_PIPE_H1,S_PIPE_H2,S_PIPE_H1,S_WALL2,S_GUN_R,S_FLOOR,S_WALL2,S_DIRT,S_PIPE_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_BR,S_WALL2,S_PIPE_UL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_DIRT,S_DIRT2,S_DIRT,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_FLOOR,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL,S_FLOOR,S_WALL,S_WALL_H2,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_DIRT2,S_DIRT2,S_PIPE_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V3,S_DIRT2,S_DIRT2,S_DIRT2,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_D,S_FLOOR,S_FLOOR,S_GUN_D,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_D,S_FLOOR,S_FLOOR,S_GUN_D,S_PIPE_VS,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_BR,S_WALL2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V1,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_EVIL_EYE_C,S_EVIL_EYE_C,S_EVIL_EYE_C,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_DIRT2,S_DIRT,S_DIRT2,S_PIPE_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_DIRT2,S_DIRT,S_DIRT,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_UR,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_GUN_R,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_FLOOR,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL2,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_UR,S_PIPE_UL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_DIRT2,S_DIRT2,S_DIRT,S_DIRT,S_PIPE_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V3,S_DIRT,S_DIRT,S_DIRT2,S_PIPE_BR,S_PIPE_H1,S_CORKSCREW,S_PIPE_H1,S_WALL,S_PIPE_HE,S_GUN_R,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_DIRT,S_DIRT,S_DIRT2,S_DIRT,S_PIPE_VS,S_FLOOR,S_PIPE_VS,S_DIRT,S_DIRT2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_FLOOR,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H3,S_WALL,S_WALL_H3,S_WALL_H1,S_WALL_H3,S_WALL,S_FLOOR,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL2,S_WALL_H1,S_WALL_H2,S_WALL_H1,S_WALL_H1,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL_H2,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_FLOOR,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H2,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL_H2,S_WALL_H3,S_WALL_H2,S_WALL,S_WALL_H2,S_WALL,S_WALL_H3,S_WALL,S_FLOOR,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL,S_PIPE_HS,S_PIPE_H1,S_PIPE_H1,S_PIPE_H1,S_PIPE_HE,S_WALL,S_FLOOR,S_WALL,S_WALL_H1,S_WALL_H3,S_WALL_H1,S_WALL2,S_WALL,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H3,S_WALL_H1,S_WALL_H1,S_WALL_H3,S_WALL_H1,S_WALL_H1,S_WALL_H3,S_WALL_H1,S_WALL_H1},
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_WALL,S_FLOOR,S_WALL,S_WALL_H1,S_EVIL_EYE_C,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL,S_PIPE_H1,S_PIPE_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_PIPE_H1,S_PIPE_H1,S_WALL,S_PIPE_H1,S_PIPE_H1,S_PIPE_H1,S_WALL,S_PIPE_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL2,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL2,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H3,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H3,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_FLOOR,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL,S_WALL,S_WALL,S_WALL,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H3,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H3,S_WALL_H1,S_WALL_H1,S_WALL_H3,S_WALL_H1,S_WALL_H1,S_WALL_H3,S_WALL_H1,S_WALL_H1,S_WALL_H3,S_WALL_H1},
{S_FLOOR,S_FLOOR,S_FLOOR,S_DIRT,S_WALL_V1,S_DIRT2,S_DIRT,S_DIRT,S_DIRT2,S_DIRT2,S_DIRT,S_DIRT2,S_DIRT,S_DIRT2,S_DIRT,S_DIRT,S_DIRT2,S_DIRT,S_DIRT,S_DIRT,S_DIRT2,S_DIRT2,S_DIRT,S_DIRT,S_DIRT2,S_DIRT,S_DIRT,S_DIRT,S_DIRT2,S_DIRT,S_DIRT,S_DIRT,S_DIRT,S_DIRT2,S_DIRT2,S_DIRT,S_DIRT,S_DIRT,S_DIRT2,S_DIRT,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V1,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_DIRT,S_DIRT2,S_DIRT2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V2,S_DIRT,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR},
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_DIRT,S_DIRT2,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL,S_WALL,S_WALL,S_WALL,S_WALL,S_WALL,S_WALL,S_WALL,S_WALL,S_WALL,S_WALL_H1,S_WALL_H1,S_WALL_H1,S_WALL,S_WALL_H2,S_WALL_H2,S_WALL,S_DIRT,S_DIRT,S_WALL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_WALL2,S_GUN_R,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_L,S_PIPE_HS,S_WALL,S_WALL2,S_WALL,S_WALL2,S_WALL,S_WALL2,S_WALL,S_WALL2,S_EVIL_EYE_C,S_WALL2,S_WALL,S_WALL2,S_EVIL_EYE_C,S_WALL2,S_WALL,S_WALL2,S_WALL,S_WALL2,S_EVIL_EYE_C,S_WALL2,S_WALL,S_DIRT2,S_DIRT,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_BR,S_PIPE_HS,S_CORKSCREW,S_PIPE_H1,S_PIPE_H2,S_PIPE_H1,S_PIPE_H2,S_PIPE_H1,S_PIPE_H2,S_PIPE_HE,S_EVIL_EYE_C,S_PIPE_HS,S_PIPE_H2,S_PIPE_BL},
{S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_VS,S_DIRT2,S_DIRT,S_PIPE_VS,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_D,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_WALL_V2,S_DIRT2,S_DIRT,S_DIRT2,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_D,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_GUN_L,S_PIPE_HS,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_BL,S_DIRT,S_DIRT,S_DIRT2,S_DIRT,S_DIRT,S_DIRT,S_DIRT2,S_DIRT2,S_DIRT,S_DIRT,S_DIRT,S_PIPE_BR,S_PIPE_H1,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HS,S_PIPE_HE,S_PIPE_HS,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_HS,S_PIPE_H1,S_PIPE_HS,S_PIPE_HS,S_CORKSCREW,S_PIPE_HE,S_FLOOR,S_PIPE_UR,S_PIPE_HE,S_FLOOR,S_FLOOR,S_FLOOR,S_PIPE_UR,S_WALL2,S_PIPE_HE,S_PIPE_HE,S_PIPE_HE,S_PIPE_BL,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR,S_FLOOR}};

//uint8_t read_map_at(uint8_t x,uint8_t y) { return the_map[y&(MAP_H-1)][x&(MAP_W-1)]; }
uint8_t read_map_at(uint8_t x,uint8_t y,uint8_t flips) {
    x = x&(MAP_W-1); y = y&(MAP_H-1);
    if(flips==0) return the_map[y][x];
    y=(MAP_H-1)-y; /// can add more weird flips
    switch(the_map[y][x]) {
        case S_GUN_D: return S_GUN_U;
        case S_GUN_U: return S_GUN_D;    
        case S_PIPE_BL: return S_PIPE_UL;
        case S_PIPE_BR: return S_PIPE_UR;
        case S_PIPE_UL: return S_PIPE_BL;
        case S_PIPE_UR: return S_PIPE_BR;            
    } /// lol
    return the_map[y][x];
}

int8_t S1_difference(uint8_t a,uint8_t b,uint8_t r) {
    int8_t d = a-b;
    if(d <= r/2 && d>= -r/2) return d;
    if(d > 0) return d-r;
    return d+r;
}

int8_t S1_distance(uint8_t a,uint8_t b,uint8_t r) {
    int8_t d = S1_difference(a,b,r);
    if(d < 0) return -d;
    return d;
}


//// OBJECTS AND STUFF ////////////////////////////////////////////////////////////

int8_t dx_for(uint8_t dir) {
    if(dir==DIR_R) return 1;
    if(dir==DIR_L) return -1;
    return 0;
}

int8_t dy_for(uint8_t dir) {
    if(dir==DIR_D) return 1;
    if(dir==DIR_U) return -1;
    return 0;
}

int8_t flip_dir(uint8_t dir) {
    if(dir==DIR_U) return DIR_D;
    if(dir==DIR_D) return DIR_U;
    return dir;
}

enum { KIND_NOTHING,
       KIND_HERO,
       KIND_BARELL, KIND_PARTICLE, KIND_EXPLOSION, KIND_GUN,
       KIND_ROBOT, KIND_JOYSTICK,
       KIND_CORKSCREW,
       KIND_DOOR,KIND_DOOR_O, 
       KIND_MIRROR,KIND_OXYGEN,KIND_CRYSTAL,
       KIND_ELECTRIC,KIND_SMOKE,KIND_FIRE,
       KIND_TENTACLES,
       KIND_DETONATOR_0, KIND_DETONATOR_1, KIND_BOMB, KIND_LEVER,
       KIND_BIGBATON,
       KINDS_COUNT };

typedef struct {
    uint8_t kind;
    uint8_t x,y;
    uint8_t facing,move;
    uint8_t counter,max_counter;
    uint8_t label;
} thing_t;

#define MAX_THINGS 1024 // ??
thing_t things[MAX_THINGS];
uint16_t first_free=0,last_occupied=0;

uint16_t add_thing(uint8_t kind,
                   uint8_t x, uint8_t y,
                   uint8_t facing, uint8_t move,
                   uint8_t counter, uint8_t max_counter,
                   uint8_t label) {
    uint16_t ni = first_free;
    if(first_free<MAX_THINGS) {
        things[first_free].kind = kind;
        things[first_free].x = x; things[first_free].y = y;
        things[first_free].facing = facing; things[first_free].move = move;
        things[first_free].counter = counter; things[first_free].max_counter = max_counter;
        things[first_free].label = label;
        
        if(first_free>last_occupied) last_occupied=first_free;
        while(first_free<MAX_THINGS &&
              things[first_free].kind!=KIND_NOTHING) first_free++;
        //tracef("pszlo ADD (k=%d,x=%d,y=%d) => ni=%d,  ff=%d lo=%d", kind,x,y,ni,first_free,last_occupied);
        return ni;
    }
    trace("miejsca ni ma!");
    return MAX_THINGS+1; /// pfff.
}

/*
void add_thing(thing_t the_thing) {
    if(first_free<MAX_THINGS) {
        things[first_free] = the_thing;
        if(first_free>last_occupied) last_occupied=first_free;
        while(first_free<MAX_THINGS &&
              things[first_free].kind!=KIND_NOTHING) first_free++;
    }
}
*/

void remove_thing(uint16_t index) {
    //tracef("rmthing i=%d (ff=%d,lo=%d)",index,first_free,last_occupied);
    things[index].kind = KIND_NOTHING;
    things[index].x = 0; things[index].y = 0;
    things[index].facing = DIR_C; things[index].move = DIR_C;
    things[index].counter = 0; things[index].max_counter = 0;
    things[index].label = 0;
    if(index<first_free) first_free = index;
    while(last_occupied>0 && things[last_occupied].kind==KIND_NOTHING) last_occupied--;
}

uint8_t sprite_for_maptile(uint8_t t, uint8_t x, uint8_t y, uint8_t subframe) {
    (void)(subframe); /// just to avoid "error: unused parameter" thing...    
    (void)(y);
    uint8_t blink=0;
    if(t==S_EVIL_EYE_C) {
        if((clock+(x>>3)+(y>>3))%16==7) blink=1;
        if(x<CENTRE-8) return S_EVIL_EYE_R+blink;
        if(x>CENTRE+8) return S_EVIL_EYE_L+blink;
        return S_EVIL_EYE_C+blink;
    }
    return t; /// will add some animations here TODO
}

uint8_t sprite_for_thing(thing_t *t, uint8_t subframe) {
    uint8_t s;
    switch(t->kind) {
        case KIND_NOTHING: return S_FLOOR; /// not the best idea; not going to happen tho ;)

        case KIND_BARELL: return S_BARELL;
        case KIND_OXYGEN: return S_OXYGEN;
        case KIND_CRYSTAL: return S_CRYSTAL;
        case KIND_BOMB: return S_BOMB;
        case KIND_DETONATOR_0: return S_DETONATOR_0;
        case KIND_DETONATOR_1: return S_DETONATOR_1;
        case KIND_JOYSTICK: return S_JOYSTICK;
        case KIND_LEVER: return (t->facing==DIR_R?S_LEVER_R:S_LEVER_L);
        case KIND_CORKSCREW: return S_CORKSCREW;
        case KIND_BIGBATON: return S_BIGBATON;

        case KIND_DOOR: return S_DOOR;
        case KIND_DOOR_O: return S_DOOR_O;
        case KIND_MIRROR: return S_MIRROR;

        case KIND_EXPLOSION: return (subframe>=4 ? S_EXPLOSION : S_EXPLOSION2);
        case KIND_FIRE: return ((clock&2) ? S_FIRE1 : S_FIRE2);

        case KIND_SMOKE: return S_SMOKE1+((clock+(subframe&4)+t->x+t->y)%4);

        case KIND_ELECTRIC:
           switch(t->facing) {
               case DIR_U: case DIR_D: return S_ELECTRIC_V1 + (subframe>=4);
               default: return S_ELECTRIC_H1 + (subframe>=4);
           }
           break; // notreached, just-in-case

        case KIND_TENTACLES:
            switch(t->facing) {
                case DIR_U: s = S_TENTACLES_U; break;
                case DIR_L: s = S_TENTACLES_L; break;
                case DIR_D: s = S_TENTACLES_D; break;
                case DIR_R: s = S_TENTACLES_R; break;
            }
            return s+(((clock+t->x+t->y)&2)>0);

        case KIND_PARTICLE:
            switch(t->facing) {
                case DIR_U: s = S_PARTICLE_U; break;
                case DIR_L: s = S_PARTICLE_L; break;
                case DIR_D: s = S_PARTICLE_D; break;
                case DIR_R: s = S_PARTICLE_R; break;
            }
            return s+(subframe>=4);

        case KIND_GUN:
            switch(t->facing) {
                case DIR_U: return S_GUN_U;
                case DIR_L: return S_GUN_L;
                case DIR_D: return S_GUN_D;
                case DIR_R: return S_GUN_R;
            }
            break; // notreached, just-in-case

        case KIND_ROBOT:
            switch(t->facing) {
                case DIR_U: return S_ROBOT_U;
                case DIR_L: return S_ROBOT_L;
                case DIR_D: return S_ROBOT_D;
                case DIR_R: return S_ROBOT_R;
            }
            break; // notreached, just-in-case

        case KIND_HERO:
            switch(t->facing) {
                case DIR_U: s = S_ACTOR_U; break;
                case DIR_L: s = S_ACTOR_L; break;
                case DIR_D: s = S_ACTOR_D; break;
                case DIR_R: s = S_ACTOR_R; break;
            }
            if(t->move!=DIR_C) s += 1+(clock%2);
            return s;
            /*
            switch(t->facing) {
                case DIR_U: return (t->y&1 ? S_ACTOR_U2 : S_ACTOR_U3);
                case DIR_L: return (t->x&1 ? S_ACTOR_L2 : S_ACTOR_L3);
                case DIR_D: return (t->y&1 ? S_ACTOR_D2 : S_ACTOR_D3);
                case DIR_R: return (t->x&1 ? S_ACTOR_R2 : S_ACTOR_R3);
            }
            */
      default: break;
    }
    return S_FLOOR; // notreached?!
}


//// MORE EDITOR-GENERATED STUFF... ///////////////////////////////////////////////

void initialize_world() {
    uint8_t x,y;
    uint16_t i;
    for(i=0;i<MAX_THINGS;i++) remove_thing(i); /// just in case...
    first_free=0;
    last_occupied=0;
    add_thing(KIND_HERO,60,11,DIR_D,DIR_C,0,0,0);
    //// object #0
    add_thing(KIND_GUN,5,1,DIR_L,DIR_C,2,5,0);
    //// object #1
    add_thing(KIND_GUN,5,3,DIR_L,DIR_C,4,5,0);
    //// object #2
    add_thing(KIND_GUN,7,3,DIR_R,DIR_C,4,5,0);
    //// object #3
    add_thing(KIND_BARELL,21,4,DIR_C,DIR_C,0,0,0);
    //// object #4
    add_thing(KIND_GUN,5,5,DIR_L,DIR_C,1,5,0);
    //// object #5
    add_thing(KIND_BARELL,24,6,DIR_C,DIR_C,0,0,0);
    //// object #6
    add_thing(KIND_BARELL,2,8,DIR_C,DIR_C,0,0,0);
    //// object #7
    add_thing(KIND_BARELL,4,9,DIR_C,DIR_C,0,0,0);
    //// object #8
    add_thing(KIND_BARELL,0,11,DIR_C,DIR_C,0,0,0);
    //// object #9
    add_thing(KIND_BARELL,1,11,DIR_C,DIR_C,0,0,0);
    //// object #10
    add_thing(KIND_BARELL,21,12,DIR_C,DIR_C,0,0,0);
    //// object #11
    add_thing(KIND_BARELL,106,10,DIR_C,DIR_C,0,0,0);
    //// object #12
    add_thing(KIND_BARELL,107,9,DIR_C,DIR_C,0,0,0);
    //// object #13
    add_thing(KIND_BARELL,108,11,DIR_C,DIR_C,0,0,0);
    //// object #14
    add_thing(KIND_BARELL,110,11,DIR_C,DIR_C,0,0,0);
    //// object #15
    add_thing(KIND_BARELL,112,12,DIR_C,DIR_C,0,0,0);
    //// object #16
    add_thing(KIND_BARELL,112,11,DIR_C,DIR_C,0,0,0);
    //// object #17
    add_thing(KIND_BARELL,112,9,DIR_C,DIR_C,0,0,0);
    //// object #18
    add_thing(KIND_BARELL,111,12,DIR_C,DIR_C,0,0,0);
    //// object #19
    add_thing(KIND_DETONATOR_0,121,9,DIR_C,DIR_C,0,0,0);
    //// object #20
    add_thing(KIND_BOMB,125,8,DIR_C,DIR_C,0,0,0);
    //// object #21
    add_thing(KIND_GUN,21,1,DIR_U,DIR_C,2,5,0);
    //// object #22
    add_thing(KIND_GUN,23,1,DIR_U,DIR_C,2,5,0);
    //// object #23
    add_thing(KIND_GUN,25,1,DIR_U,DIR_C,2,5,0);
    //// object #24
    add_thing(KIND_GUN,27,1,DIR_U,DIR_C,2,5,0);
    //// object #25
    add_thing(KIND_LEVER,6,7,DIR_R,DIR_C,0,0,0);
    //// object #26
    add_thing(KIND_BARELL,61,7,DIR_C,DIR_C,0,0,0);
    //// object #27
    add_thing(KIND_BARELL,62,6,DIR_C,DIR_C,0,0,0);
    //// object #28
    add_thing(KIND_BARELL,62,7,DIR_C,DIR_C,0,0,0);
    //// object #29
    add_thing(KIND_BARELL,68,11,DIR_C,DIR_C,0,0,0);
    //// object #30
    add_thing(KIND_BARELL,18,21,DIR_C,DIR_C,0,0,0);
    //// object #31
    add_thing(KIND_GUN,58,1,DIR_U,DIR_C,2,5,0);
    //// object #32
    add_thing(KIND_GUN,58,5,DIR_D,DIR_C,1,5,0);
    //// object #33
    add_thing(KIND_GUN,57,2,DIR_L,DIR_C,3,5,0);
    //// object #34
    add_thing(KIND_GUN,57,3,DIR_L,DIR_C,4,5,0);
    //// object #35
    add_thing(KIND_GUN,57,4,DIR_L,DIR_C,5,5,0);
    //// object #36
    add_thing(KIND_GUN,59,2,DIR_R,DIR_C,3,5,0);
    //// object #37
    add_thing(KIND_GUN,59,3,DIR_R,DIR_C,4,5,0);
    //// object #38
    add_thing(KIND_GUN,59,4,DIR_R,DIR_C,5,5,0);
    //// object #39
    add_thing(KIND_BARELL,107,29,DIR_C,DIR_C,0,0,0);
    //// object #40
    add_thing(KIND_BARELL,104,30,DIR_C,DIR_C,0,0,0);
    //// object #41
    add_thing(KIND_BARELL,105,31,DIR_C,DIR_C,0,0,0);
    //// object #42
    add_thing(KIND_GUN,1,23,DIR_L,DIR_C,4,5,0);
    //// object #43
    add_thing(KIND_GUN,3,21,DIR_R,DIR_C,2,5,0);
    //// object #44
    add_thing(KIND_BARELL,7,20,DIR_C,DIR_C,0,0,0);
    //// object #45
    add_thing(KIND_GUN,3,23,DIR_R,DIR_C,4,5,0);
    //// object #46
    add_thing(KIND_GUN,49,14,DIR_D,DIR_C,5,5,0);
    //// object #47
    add_thing(KIND_GUN,51,14,DIR_D,DIR_C,5,5,0);
    //// object #48
    add_thing(KIND_GUN,52,14,DIR_D,DIR_C,5,5,0);
    //// object #49
    add_thing(KIND_BOMB,107,11,DIR_C,DIR_C,0,0,0);
    //// object #50
    add_thing(KIND_BOMB,111,10,DIR_C,DIR_C,0,0,0);
    //// object #51
    add_thing(KIND_BARELL,110,10,DIR_C,DIR_C,0,0,0);
    //// object #53
    add_thing(KIND_DOOR,65,13,DIR_C,DIR_C,0,0,0);
    //// object #54
    add_thing(KIND_DOOR,59,13,DIR_C,DIR_C,0,0,0);
    //// object #55
    add_thing(KIND_DOOR,62,26,DIR_C,DIR_C,0,0,0);
    //// object #56
    add_thing(KIND_DOOR,82,28,DIR_C,DIR_C,0,0,0);
    //// object #57
    add_thing(KIND_DOOR,95,26,DIR_C,DIR_C,0,0,0);
    //// object #58
    add_thing(KIND_DOOR,87,13,DIR_C,DIR_C,0,0,0);
    //// object #59
    add_thing(KIND_DOOR,104,13,DIR_C,DIR_C,0,0,0);
    //// object #60
    add_thing(KIND_DOOR,104,6,DIR_C,DIR_C,0,0,0);
    //// object #61
    add_thing(KIND_DOOR,117,13,DIR_C,DIR_C,0,0,0);
    //// object #62
    add_thing(KIND_DOOR,6,13,DIR_C,DIR_C,0,0,0);
    //// object #63
    add_thing(KIND_DOOR,26,17,DIR_C,DIR_C,0,0,0);
    //// object #64
    add_thing(KIND_DOOR,30,17,DIR_C,DIR_C,0,0,0);
    //// object #65
    add_thing(KIND_DOOR,34,17,DIR_C,DIR_C,0,0,0);
    //// object #66
    add_thing(KIND_DOOR,38,17,DIR_C,DIR_C,0,0,0);
    //// object #67
    add_thing(KIND_DOOR,26,21,DIR_C,DIR_C,0,0,0);
    //// object #68
    add_thing(KIND_DOOR,23,26,DIR_C,DIR_C,0,0,0);
    //// object #69
    add_thing(KIND_DOOR,47,31,DIR_C,DIR_C,0,0,0);
    //// object #70
    add_thing(KIND_DOOR,1,28,DIR_C,DIR_C,0,0,0);
    //// object #71
    add_thing(KIND_DOOR,7,26,DIR_C,DIR_C,0,0,0);
    //// object #72
    add_thing(KIND_DOOR,70,13,DIR_C,DIR_C,0,0,0);
    //// object #73
    add_thing(KIND_DOOR,67,29,DIR_C,DIR_C,0,0,0);
    //// object #74
    add_thing(KIND_DOOR,16,23,DIR_C,DIR_C,0,0,0);
    //// object #75
    add_thing(KIND_ROBOT,13,1,DIR_R,DIR_C,0,0,0);
    //// object #76
    add_thing(KIND_JOYSTICK,23,4,DIR_C,DIR_C,0,0,0);
    //// object #77
    add_thing(KIND_DOOR,84,26,DIR_C,DIR_C,0,0,0);
    //// object #78
    add_thing(KIND_ROBOT,89,22,DIR_D,DIR_C,0,0,0);
    //// object #79
    add_thing(KIND_DOOR,101,25,DIR_C,DIR_C,0,0,0);
    //// object #80
    add_thing(KIND_JOYSTICK,86,23,DIR_C,DIR_C,0,0,0);
    //// object #81
    add_thing(KIND_ELECTRIC,71,18,DIR_U,DIR_C,0,0,0);
    //// object #82
    add_thing(KIND_ELECTRIC,71,19,DIR_U,DIR_C,0,0,0);
    //// object #83
    add_thing(KIND_ELECTRIC,69,19,DIR_U,DIR_C,0,0,0);
    //// object #84
    add_thing(KIND_ELECTRIC,69,18,DIR_U,DIR_C,0,0,0);
    //// object #85
    add_thing(KIND_LEVER,68,12,DIR_L,DIR_C,0,0,0);
    //// object #86
    add_thing(KIND_ELECTRIC,85,24,DIR_L,DIR_C,0,0,0);
    //// object #87
    add_thing(KIND_ELECTRIC,86,24,DIR_L,DIR_C,0,0,0);
    //// object #88
    add_thing(KIND_ELECTRIC,87,24,DIR_L,DIR_C,0,0,0);
    //// object #89
    add_thing(KIND_LEVER,36,0,DIR_L,DIR_C,0,0,0);
    //// object #90
    add_thing(KIND_ELECTRIC,18,13,DIR_L,DIR_C,0,0,0);
    //// object #91
    add_thing(KIND_OXYGEN,3,9,DIR_C,DIR_C,0,0,0);
    //// object #92
    add_thing(KIND_OXYGEN,2,9,DIR_C,DIR_C,0,0,0);
    //// object #93
    add_thing(KIND_OXYGEN,106,12,DIR_C,DIR_C,0,0,0);
    //// object #94
    add_thing(KIND_CRYSTAL,50,3,DIR_C,DIR_C,0,0,0);
    //// object #95
    add_thing(KIND_LEVER,99,25,DIR_L,DIR_C,0,0,0);
    //// object #96
    add_thing(KIND_MIRROR,91,19,DIR_C,DIR_C,0,0,0);
    //// object #97
    add_thing(KIND_ELECTRIC,35,27,DIR_U,DIR_C,0,0,0);
    //// object #98
    add_thing(KIND_OXYGEN,66,8,DIR_C,DIR_C,0,0,0);
    //// object #99
    add_thing(KIND_OXYGEN,48,29,DIR_C,DIR_C,0,0,0);
    //// object #100
    add_thing(KIND_CRYSTAL,121,31,DIR_C,DIR_C,0,0,0);
    //// object #101
    add_thing(KIND_CRYSTAL,119,31,DIR_C,DIR_C,0,0,0);
    //// object #102
    add_thing(KIND_BARELL,55,0,DIR_C,DIR_C,0,0,0);
    //// object #103
    add_thing(KIND_ELECTRIC,42,7,DIR_L,DIR_C,0,0,0);
    //// object #104
    add_thing(KIND_ELECTRIC,43,7,DIR_L,DIR_C,0,0,0);
    //// object #105
    add_thing(KIND_ELECTRIC,45,7,DIR_L,DIR_C,0,0,0);
    //// object #106
    add_thing(KIND_ELECTRIC,44,7,DIR_L,DIR_C,0,0,0);
    //// object #107
    add_thing(KIND_BIGBATON,79,8,DIR_C,DIR_C,0,0,0);
    //// object #108
    add_thing(KIND_TENTACLES,78,11,DIR_D,DIR_C,0,0,0);
    //// object #109
    add_thing(KIND_TENTACLES,80,11,DIR_D,DIR_C,0,0,0);
    //// object #110
    add_thing(KIND_TENTACLES,78,9,DIR_U,DIR_C,0,0,0);
    //// object #111
    add_thing(KIND_TENTACLES,80,9,DIR_U,DIR_C,0,0,0);
    //// object #112
    add_thing(KIND_TENTACLES,46,18,DIR_L,DIR_C,0,0,0);
    //// object #113
    add_thing(KIND_TENTACLES,46,20,DIR_L,DIR_C,0,0,0);
    //// object #114
    add_thing(KIND_TENTACLES,34,0,DIR_U,DIR_C,0,0,0);
    //// object #115
    add_thing(KIND_TENTACLES,34,31,DIR_D,DIR_C,0,0,0);
    //// object #116
    add_thing(KIND_TENTACLES,34,6,DIR_D,DIR_C,0,0,0);
    //// object #117
    add_thing(KIND_TENTACLES,28,23,DIR_U,DIR_C,0,0,0);
    //// object #118
    add_thing(KIND_TENTACLES,16,17,DIR_L,DIR_C,0,0,0);
    //// object #119
    add_thing(KIND_TENTACLES,41,20,DIR_R,DIR_C,0,0,0);
    //// object #120
    add_thing(KIND_TENTACLES,41,18,DIR_R,DIR_C,0,0,0);
    //// object #121
    add_thing(KIND_ELECTRIC,42,5,DIR_L,DIR_C,0,0,0);
    //// object #122
    add_thing(KIND_ELECTRIC,43,5,DIR_L,DIR_C,0,0,0);
    //// object #123
    add_thing(KIND_ELECTRIC,44,5,DIR_L,DIR_C,0,0,0);
    //// object #124
    add_thing(KIND_ELECTRIC,45,5,DIR_L,DIR_C,0,0,0);
    //// object #125
    add_thing(KIND_ELECTRIC,42,9,DIR_L,DIR_C,0,0,0);
    //// object #126
    add_thing(KIND_ELECTRIC,43,9,DIR_L,DIR_C,0,0,0);
    //// object #127
    add_thing(KIND_ELECTRIC,44,9,DIR_L,DIR_C,0,0,0);
    //// object #128
    add_thing(KIND_ELECTRIC,45,9,DIR_L,DIR_C,0,0,0);
    //// object #129
    add_thing(KIND_BOMB,52,20,DIR_C,DIR_C,0,0,0);
    //// object #130
    add_thing(KIND_OXYGEN,35,19,DIR_C,DIR_C,0,0,0);
    //// object #131
    add_thing(KIND_OXYGEN,33,20,DIR_C,DIR_C,0,0,0);
    //// object #132
    add_thing(KIND_TENTACLES,41,19,DIR_R,DIR_C,0,0,0);
    //// object #133
    add_thing(KIND_TENTACLES,46,19,DIR_L,DIR_C,0,0,0);
    //// object #134
    add_thing(KIND_BOMB,26,19,DIR_C,DIR_C,0,0,0);
    //// object #135
    add_thing(KIND_DETONATOR_0,30,19,DIR_C,DIR_C,0,0,0);
    //// object #136
    add_thing(KIND_TENTACLES,39,18,DIR_L,DIR_C,0,0,0);
    //// object #137
    add_thing(KIND_TENTACLES,39,19,DIR_L,DIR_C,0,0,0);
    //// object #138
    add_thing(KIND_TENTACLES,39,20,DIR_L,DIR_C,0,0,0);
    //// object #139
    add_thing(KIND_TENTACLES,38,20,DIR_U,DIR_C,0,0,0);
    //// object #140
    add_thing(KIND_TENTACLES,37,20,DIR_R,DIR_C,0,0,0);
    //// object #141
    add_thing(KIND_TENTACLES,37,19,DIR_R,DIR_C,0,0,0);
    //// object #142
    add_thing(KIND_TENTACLES,37,18,DIR_D,DIR_C,0,0,0);
    //// object #143
    add_thing(KIND_LEVER,38,19,DIR_L,DIR_C,0,0,0);
    //// object #144
    add_thing(KIND_OXYGEN,68,25,DIR_C,DIR_C,0,0,0);
}


//// GAME MECHANICS AND STUFF /////////////////////////////////////////////////////
void dreamy_palette();
void behind_the_mirror_palette();

void the_other_side() {
    uint16_t t;
    if(game_behind_mirror==1) {
        game_behind_mirror = 0;
        dreamy_palette();
    } else {
        game_behind_mirror = 1;
        behind_the_mirror_palette();
    }
    /// flip all things
    for(t=0;t<=last_occupied;t++) {
        if(things[t].kind==KIND_NOTHING) continue;
        things[t].y = (MAP_H-1) - things[t].y;
        if(things[t].kind != KIND_HERO) {
            things[t].facing = flip_dir(things[t].facing);
            things[t].move = flip_dir(things[t].move);
        } /// the hero doesn't flip as it's her mirror-passing
    }
}

/// TMP TMP potem to zakodujemy w numerkach kindów?
uint8_t is_flamable(uint8_t kind) {
    switch(kind) {
    case KIND_BARELL:
    case KIND_DOOR:
    case KIND_LEVER: 
    case KIND_GUN: return 1;
    default: break;
    }
    return 0;
}

uint8_t is_explodable(uint8_t kind) {
    switch(kind) {   
    case KIND_BOMB:     
    case KIND_OXYGEN:
    case KIND_GUN: return 1;
    default: break;
    }
    return 0;
}

uint8_t explosion_radius_for(uint8_t kind) {
    switch(kind) {
    case KIND_OXYGEN:
    case KIND_BOMB: return 1;
    default: break;
    }
    return 0;
}

void explosion(thing_t *subject) {
    uint16_t t;
    uint8_t radius = 0;
    int8_t i,j,x,y;
    subject->move = DIR_C; subject->facing = DIR_C;
    if(is_flamable(subject->kind)) {
        subject->kind = KIND_FIRE;
        subject->counter = 51; subject->max_counter = 0; /// hmm?
    }
    if(is_explodable(subject->kind)) {
        radius = explosion_radius_for(subject->kind);
        subject->kind = KIND_EXPLOSION;
        subject->counter = 2; subject->max_counter = 0;
        for(t=0;t<=last_occupied;t++) {
            if(things[t].kind==KIND_NOTHING) continue;
            if(S1_distance(things[t].x,subject->x,MAP_W)<=radius &&
               S1_distance(things[t].y,subject->y,MAP_H)<=radius) explosion(&things[t]);
        }
        /// ok and just for the giggles:
        if(visible_from(subject->x,subject->y,things[0].x,things[0].y)) sfx_boom();
        for(i=-radius;i<=radius;i++)
            for(j=-radius;j<=radius;j++) {
                x = (subject->x+i)&(MAP_W-1);
                y = (subject->y+j)&(MAP_H-1);
                if(read_map_at(x,y,game_behind_mirror)==S_FLOOR) {
                    t = add_thing(KIND_EXPLOSION,x,y,DIR_C,DIR_C,3,0,0);
                }
            }
    }
}

/// ok this is pretty specific but for now...
void explode_all_bombs_with_label(uint8_t label) {
    uint16_t t;
    for(t=0;t<=last_occupied;t++) {
        if(things[t].kind!=KIND_BOMB) continue;
        if(things[t].label==label) explosion(&things[t]);
    }
}

/// this might not work very well...
uint8_t is_free(uint8_t x, uint8_t y) {
    uint16_t t;
    if(read_map_at(x,y,game_behind_mirror)!=S_FLOOR) return 0; /// XD
    for(t=0;t<=last_occupied;t++) {
        if(things[t].kind==KIND_NOTHING) continue;
        if(things[t].x==x && things[t].y==y) return 0;
    }
    return 1;
}

void spawn_smoke(uint8_t x, uint8_t y) {
    (void)(x);
    (void)(y);
    /*
    thing_t smoke;
    smoke.kind = KIND_SMOKE; smoke.counter=2+(clock%8);
    smoke.x = x; smoke.y = (y-1)&(MAP_H-1);

    if(is_free(smoke.x,smoke.y)) { add_thing(smoke); return; }
    if((clock&1)==0) {
        smoke.x = (x-1)&(MAP_W-1); smoke.y = y;
        if(is_free(smoke.x,smoke.y)) { add_thing(smoke); return; }
        smoke.x = (x+1)&(MAP_W-1); smoke.y = y;
        if(is_free(smoke.x,smoke.y)) { add_thing(smoke); return; }
    } else {
        smoke.x = (x+1)&(MAP_W-1); smoke.y = y;
        if(is_free(smoke.x,smoke.y)) { add_thing(smoke); return; }
        smoke.x = (x-1)&(MAP_W-1); smoke.y = y;
        if(is_free(smoke.x,smoke.y)) { add_thing(smoke); return; }
    }
    smoke.x = x; smoke.y = (y-1)&(MAP_H-1);
    if(is_free(smoke.x,smoke.y)) { add_thing(smoke); return; }
    */
    //// TODO TODO ;)
}

int can_move(uint16_t index) {
    uint16_t t;
    uint8_t nx,ny;
    thing_t *mover,*collider;
    mover = &things[index]; // XD

    if(mover->kind==KIND_NOTHING || mover->move==DIR_C) return 0;

    nx = (mover->x+dx_for(mover->move)) & (MAP_W-1);
    ny = (mover->y+dy_for(mover->move)) & (MAP_H-1);
    /// collision with map?
    if(read_map_at(nx,ny,game_behind_mirror)!=S_FLOOR) return 0; /// XD
    /// then maybe with other object?
    for(t=0;t<=last_occupied;t++) {
        if(things[t].kind==KIND_NOTHING) continue;
        if(things[t].x==nx && things[t].y==ny) {
            collider = &things[t];
            /// na szybkości TMP
            if(mover->kind==KIND_HERO && collider->kind==KIND_DOOR) {
                //remove_thing(t); /// the collider
                collider->kind=KIND_DOOR_O;
                collider->counter=2;
                sfx_open(); // XD
                return 0;
            }
            if(mover->kind==KIND_HERO && collider->kind==KIND_MIRROR) {
                if(mover->move==DIR_U || mover->move==DIR_D) {
                    the_other_side(); /// :o
                    return 1;
                }
            }
            if(mover->kind==KIND_HERO && collider->kind==KIND_BIGBATON) {
                victoly(); /// !!
            }
            if(mover->kind==KIND_PARTICLE) {
                switch(collider->kind) {
                case KIND_NOTHING:
                case KIND_FIRE:
                case KIND_SMOKE:
                case KIND_PARTICLE:
                    mover->x = nx; mover->y = ny;
                    return 1;
                case KIND_CRYSTAL:
                    // TODO: spawn 2 particles
                    return 0;
                default:
                    if(is_explodable(collider->kind) || is_flamable(collider->kind))
                        explosion(collider);
                    return 0;
                }
            }

            switch(collider->kind) {
                case KIND_NOTHING:
                    mover->x = nx; mover->y = ny;
                    return 1;

                case KIND_DETONATOR_0:
                    collider->kind = KIND_DETONATOR_1;
                    explode_all_bombs_with_label(collider->label); /// XD
                    return 0;

                case KIND_OXYGEN:
                    if(mover->kind==KIND_HERO) {
                        oxygen_level += 16;
                        if(oxygen_level > 1600) oxygen_level=1600;
                    }
                case KIND_BARELL: /// TODO: other pushables...
                case KIND_BOMB:
                case KIND_MIRROR: /// with the exception of frontal passing it's pushable
                    if(mover->kind==KIND_PARTICLE) {
                        explosion(collider); explosion(mover);
                        return 0;
                    } //// lol
                    collider->move = mover->move;
                    if(can_move(t)) {
                        mover->x = nx; mover->y = ny;
                        if(visible_from(mover->x,mover->y,things[0].x,things[0].y))
                            sfx_push();
                        return 1;
                    }
                    collider->move=DIR_C;
                    return 0;

                //// TODO :)

                default: return 0;
            }
         } 
     } 
     /// boom just move'em. 
     mover->x = nx; 
     mover->y = ny; 
     return 1; 
 } 


void update_world() {
    uint16_t t,t2;

    /// cleanup after previous step (animation info and stuff?)
    for(t=0;t<=last_occupied;t++) {
        if(things[t].kind==KIND_NOTHING) continue;
        things[t].move = DIR_C;
    }
    /// and the new stuff (moves, collisions, whatever)
    for(t=0;t<=last_occupied;t++) {
        if(things[t].kind==KIND_NOTHING) continue;
        switch(things[t].kind) {
            case KIND_HERO:
                things[t].move = joystick;
                if(joystick!=DIR_C) {
                    things[t].facing = joystick;
                    sfx_step();
                    oxygen_level--;
                    reset_joystick(); /// hehe.
                }
                if(!can_move(t)) things[t].move = DIR_C;
                break;
            case KIND_PARTICLE: /////// WTF?
                things[t].move = things[t].facing;
                if(!can_move(t)) {
                    things[t].kind = KIND_EXPLOSION; /// TODO: ESKTRAKCJA EKSPLOZJI WIESZ?!
                    things[t].facing = DIR_C; things[t].move = DIR_C;
                    things[t].counter = 2; things[t].max_counter = 0;
                }
                if(--(things[t].counter)==0) remove_thing(t); // in case they leak? TODO
                break;
            case KIND_EXPLOSION:
            case KIND_DOOR_O: /// XD
                if(--(things[t].counter)==0) remove_thing(t); // :)
                break;
            case KIND_GUN:
                if((--things[t].counter)==1) {
                    things[t].counter=things[t].max_counter;
                    t2 = add_thing(KIND_PARTICLE,
                                   things[t].x,things[t].y,
                                   things[t].facing,things[t].facing,
                                   230,0,0);                    
                    can_move(t2); /// yup.
                }
                /// guns don't move.
                break;
            case KIND_FIRE:
                if(--(things[t].counter)<1) remove_thing(t);
                else if(things[t].counter%10) spawn_smoke(things[t].x,things[t].y);
                break;
            case KIND_SMOKE:
                if(--(things[t].counter)<1) remove_thing(t);
                else if(things[t].counter%4==3) spawn_smoke(things[t].x,things[t].y);
                break;
            case KIND_BARELL:
            case KIND_OXYGEN:
            case KIND_BOMB:
            case KIND_MIRROR:
                break; /// skip the can_move thing, it's managed by the mover.
            /// TODO.
            default:
                if(!can_move(t)) things[t].move = DIR_C;
                break;
        }
    }
}


//// DISPLAY AND STUFF ////////////////////////////////////////////////////////////

uint8_t visible_from(uint8_t src_x,uint8_t src_y,uint8_t tgt_x,uint8_t tgt_y) {
    return (S1_distance(src_x,tgt_x,MAP_W)<=VIEW_RADIUS_W &&
            S1_distance(src_y,tgt_y,MAP_H)<=VIEW_RADIUS_H);
}


void display(uint8_t subframe) {
    uint8_t spr;
    uint8_t x_offset,y_offset;
    int32_t x,y;
    int8_t i,j;
    uint16_t t;
    thing_t *a_thing;
    thing_t *actor = &things[0]; // :)

    *DRAW_COLORS = 0x4320;
    //// draw the map
    x_offset = CENTRE + (8-subframe)*dx_for(actor->move);
    y_offset = CENTRE + (8-subframe)*dy_for(actor->move);
    for(j=-VIEW_RADIUS_H;j<=VIEW_RADIUS_H;j++)
        for(i=-VIEW_RADIUS_W;i<=VIEW_RADIUS_W;i++) {
            x = x_offset + i*8;
            y = y_offset + j*8;
            spr = sprite_for_maptile(read_map_at(actor->x+i,actor->y+j,game_behind_mirror),
                                     x,y, /// :D
                                     subframe);

            display_sprite(spr,x,y);
        }
    /// and animate objects
    for(t=0;t<=last_occupied;t++) {
        if(things[t].kind==KIND_NOTHING) continue;
        a_thing = &things[t];
        if(visible_from(actor->x,actor->y,a_thing->x,a_thing->y)) {
            spr = sprite_for_thing(a_thing, subframe);
            x = x_offset + S1_difference(a_thing->x,actor->x,MAP_W)*8
                - (8-subframe)*dx_for(a_thing->move);
            y = y_offset + S1_difference(a_thing->y,actor->y,MAP_H)*8
                - (8-subframe)*dy_for(a_thing->move);
            display_sprite(spr,x,y);
        }
    }
    /// and display oxygen level
    *DRAW_COLORS = 0x0021;
    rect(29,145,102,10);
    *DRAW_COLORS = 0x0013;
    rect(30,146,(oxygen_level>>4),8);
}

void dreamy_palette() {
    PALETTE[0] = 0x521296;
    PALETTE[1] = 0x8a1fac;
    PALETTE[2] = 0xd4864a;
    PALETTE[3] = 0xebdb5e;
}

void behind_the_mirror_palette() {
    PALETTE[0] = 0x141433;
    PALETTE[1] = 0x141f66;
    PALETTE[2] = 0x244ab3;
    PALETTE[3] = 0x668fcc;
}


//// beautiful music mmm... ///////////////////////////////////////////////////////

/// hahahahaha
#define C1 32
#define C2 65
#define G1 49
#define As1 58
#define F1 43
#define Ds3 155
#define As2 116
#define Cs2 69
#define Gs2 103 // maybe 104...?
#define C3 (2*C2)
#define G2 (2*G1)
#define F2 (2*F1)

#define LEN 80
const uint32_t tune[LEN] = {
    C2, C2, C2, C3, Ds3,
    C2, C2, C2, C3, Ds3,
    C2, C2, C2, C3, Ds3,
    C2, C2, C2, C3, Ds3,
    G1, G1, G1, G2, As2,
    G1, G1, G1, G2, As2,
    G1, G1, G1, G2, As2,
    G1, G1, G1, G2, As2,
    As1, As1, As1, As2, Cs2*2,
    As1, As1, As1, As2, Cs2*2,
    As1, As1, As1, As2, Cs2*2,
    As1, As1, As1, As2, Cs2*2,
    F1, F1, F1, F2, Gs2,
    F1, F1, F1, F2, Gs2,
    F1, F1, F1, F2, Gs2,
    F1, F1, F1, F2, Gs2
};

uint8_t tune_pc = 0;


//// GAME STATES AND STUFF ////////////////////////////////////////////////////////

void gameover() {
    uint16_t t;
    gamestate = OVER;
    subframe = 0; clock = 0;
    for(t=0;t<MAX_THINGS;t++) remove_thing(t); // just in case...
    sfx_death();
}

void victoly() {
    uint16_t t;
    gamestate = VICTOLY;
    subframe = 0; clock = 0;
    for(t=0;t<MAX_THINGS;t++) remove_thing(t); // just in case...
    sfx_win();
}


void title_frame() {
    int8_t i,j;
    thing_t t;
    *DRAW_COLORS = 0x4320; // :)
    //// draw stuff
    for(j=-VIEW_RADIUS_H;j<=VIEW_RADIUS_H;j++)
        for(i=-VIEW_RADIUS_W;i<=VIEW_RADIUS_W;i++) 
            //display_sprite(S_FLOOR,CENTRE+subframe+i*8,CENTRE+subframe+j*8);
            display_sprite(S_FLOOR,CENTRE+i*8,CENTRE+(8-subframe)+j*8);
    /// and rotating cosmonaut because yolo
    t.kind = KIND_HERO; t.move=DIR_C; t.facing=tune_pc%4;
    display_sprite(sprite_for_thing(&t, subframe),CENTRE,CENTRE);
    /// and info    
    *DRAW_COLORS = 2;
    text("  drcz presents:",8,10);
    text("       ZxZ", 12, 29);
    text("    2022.01.23",8,100);
    text("for wasm4 gamejam",12,108);
    if(clock>MIN_TIME) text("to save the planet",8,142);
    if(clock>MIN_TIME) text("    press X...",8,150);
    *DRAW_COLORS = 3;
    text("  drcz presents:",7,9);
    text("    2022.01.23",7,99);
    text("for wasm4 gamejam",11,107);
    *DRAW_COLORS = 4;
    text("       ZxZ", 11, 28);
    *DRAW_COLORS = 3+((tune_pc>>1)&1);
    if(clock>MIN_TIME) text("to save the planet",7,141);
    if(clock>MIN_TIME) text("    press X...",7,149);

    if(subframe==0) {
        tone(tune[tune_pc]*3, 20, 100, TONE_TRIANGLE);
        tone(tune[tune_pc], 20, 100, TONE_PULSE1|TONE_MODE2);
        //if(tune[tune_pc]<=C2) tone(tune[tune_pc]*3, 60, 100, TONE_TRIANGLE);
        if(tune_pc==0||tune_pc==40) tone(130+(910<<16),255,100, TONE_PULSE2);
        tune_pc++; tune_pc%=LEN;
    }
}


void briefing_frame() {
    int8_t i,j;
    thing_t t;
    *DRAW_COLORS = 0x4320; // :)
    //// draw stuff
    for(j=-VIEW_RADIUS_H;j<=VIEW_RADIUS_H;j++)
        for(i=-VIEW_RADIUS_W;i<=VIEW_RADIUS_W;i++) 
            display_sprite(S_FLOOR,CENTRE+i*8,CENTRE+(8-subframe)+j*8);
    t.kind = KIND_HERO; t.move=DIR_C; t.facing=tune_pc%4;
    display_sprite(sprite_for_thing(&t, subframe),CENTRE,CENTRE);
    /// and info
    *DRAW_COLORS = 2;
    text("General Protagonist,",1,8);
    text("the Alien Torus is a",1,16);
    text("threat to our planet",1,24);
    text("  and only you can",1,32);
    text("    destroy it!",1,40);

    text("Our intel'd figured",5,90);
    text("there must be a Big",5,98);
    text("Button in front of",9,106);
    text("a row of Evil Eyes,",5,114);
    text("pressing it should",9,122);
    text("blow the damn Tous",9,130);
    text(" up... Good luck!",9,138);

    if(clock>MIN_TIME) text("    press X...",7,150);

    *DRAW_COLORS = 4;
    text("General Protagonist,",0,7);
    text("the Alien Torus is a",0,15);
    text("threat to our planet",0,23);
    text("  and only you can",0,31);
    text("    destroy it!",0,39);

    text("Our intel'd figured",4,89);
    text("there must be a Big",4,97);
    text("Button in front of",8,105);
    text("a row of Evil Eyes,",4,113);
    text("pressing it should",8,121);
    text("blow the damn Tous",8,129);
    text(" up... Good luck!",8,137);

    *DRAW_COLORS = 3+((tune_pc>>1)&1);
    if(clock>MIN_TIME) text("    press X...",7,149);
    
    if(subframe==0) {
        tone(tune[tune_pc]*3, 20, 100, TONE_TRIANGLE);
        tone(tune[tune_pc], 20, 100, TONE_PULSE1|TONE_MODE2);
        if(tune_pc==0||tune_pc==40) tone(130+(910<<16),255,100, TONE_PULSE2);
        tune_pc++; tune_pc%=LEN;
    }
}

void gameover_frame() {
    int8_t i,j;
    thing_t t;
    *DRAW_COLORS = 0x4320; // :)
    //// draw stuff
    for(j=-VIEW_RADIUS_H;j<=VIEW_RADIUS_H;j++)
        for(i=-VIEW_RADIUS_W;i<=VIEW_RADIUS_W;i++) 
            display_sprite(S_FLOOR,CENTRE+i*8,CENTRE+j*8+subframe);
    t.kind = KIND_HERO; t.facing=tune_pc%4; t.move=tune_pc%4;
    display_sprite(sprite_for_thing(&t, subframe),CENTRE,CENTRE);
    /// and info    
    *DRAW_COLORS = 2;
    text("   you are dead", 12, 59);
    if(clock>MIN_TIME) text("      press X",8,142);
    *DRAW_COLORS = 4;
    text("   you are dead", 11, 58);
    *DRAW_COLORS = 3+((tune_pc>>1)&1);
    if(clock>MIN_TIME) text("      press X",7,141);
    
    if(subframe==0) {
        if(tune[tune_pc]<=C2) {
            tone(tune[tune_pc]*2|((tune[tune_pc]*2-3)<<16), 50, 100, TONE_PULSE1);
            tone(tune[tune_pc]+1, 50, 100, TONE_PULSE2);
        } else {
            tone(tune[tune_pc]*4, 5|(5<<8)|(5<<24), 100, TONE_TRIANGLE);
        }
        tune_pc++; tune_pc%=LEN;
    }
}

void victoly_frame() {
    int8_t i,j;
    thing_t t;
    *DRAW_COLORS = 0x4320; // :)
    //// draw stuff
    for(j=-VIEW_RADIUS_H;j<=VIEW_RADIUS_H;j++)
        for(i=-VIEW_RADIUS_W;i<=VIEW_RADIUS_W;i++) 
            display_sprite(S_FLOOR,CENTRE+i*8,CENTRE+j*8+subframe);
    /// and rotating cosmonaut because yolo
    t.kind = KIND_HERO; t.facing=tune_pc%4;
    display_sprite(sprite_for_thing(&t, subframe),CENTRE,CENTRE);
    /// and info    
    *DRAW_COLORS = 2;
    text("     VICTOLY", 12, 59);
    if(clock>MIN_TIME) text("      press X",8,142);
    *DRAW_COLORS = 4;
    text("     VICTOLY", 11, 58);
    *DRAW_COLORS = 3+((tune_pc>>1)&1);
    if(clock>MIN_TIME) text("      press X",7,141);
    if(subframe==0) {
        if(tune[tune_pc]<=C2) {
            tone(tune[tune_pc]*2|((tune[tune_pc]*2-3)<<16), 50, 100, TONE_PULSE1);
            tone(tune[tune_pc]+1, 50, 100, TONE_PULSE2);
        } else {
            tone(tune[tune_pc]*4, 5|(5<<8)|(5<<24), 100, TONE_TRIANGLE);
        }
        tune_pc++; tune_pc%=LEN;
    }

}


/// THE GAME MAIN DRIVER THINGS ///////////////////////////////////////////////////

void start() {
    gamestate = TITLE;
    subframe = 0;
    tune_pc = 0;
}

void update () {
    
    switch(gamestate) {
        case TITLE:
            dreamy_palette();
            title_frame();
            if (clock>MIN_TIME && (*GAMEPAD1 & (BUTTON_1|BUTTON_2))) {
                gamestate=BRIEFING;
                clock = 0; subframe = 0;
            }
            break;

        case BRIEFING:
            briefing_frame();
            if (clock>MIN_TIME && (*GAMEPAD1 & (BUTTON_1|BUTTON_2))) {
                gamestate=GAME;
                initialize_world();
                oxygen_level = 16*99; /// best place for this XD
                game_behind_mirror = 0;
                clock = 0;
                subframe = 7; // :D
                reset_joystick();
            }
            break;
            
        case GAME:
            update_joystick();
            if(subframe==0) update_world();
            if(subframe==4 && music_on) {
                if(tune[tune_pc]<=C2) tone(tune[tune_pc], 40, 30, TONE_PULSE1);
                tone(tune[tune_pc]*2, 20, 30, TONE_PULSE2);
                tune_pc++; tune_pc%=LEN;
            }
            display(subframe);
            if(subframe==6) reset_joystick(); /// sometimes it's better this way...
            break;
            
        case OVER:
            gameover_frame();
            if (clock>MIN_TIME && (*GAMEPAD1 & (BUTTON_1|BUTTON_2))) {
                gamestate=TITLE;
                clock = 0;
            }
            break;
            
        case VICTOLY:
            victoly_frame();
            if (clock>MIN_TIME && (*GAMEPAD1 & (BUTTON_1|BUTTON_2))) {
                gamestate = TITLE;
                clock = 0;
            }
            break;
    }    
    subframe++; subframe%=9;
    if(subframe==0) clock++;
}

/// that's it.
